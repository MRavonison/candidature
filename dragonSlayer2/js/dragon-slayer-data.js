'use strict';


////////////////////// DONNEES GLOBALES //////////////////////

/*
 * Liste des directions possibles des sprites (le joueur par exemple).
 */
const DIRECTION_SOUTH = 0;
const DIRECTION_WEST  = 1;
const DIRECTION_NORTH = 2;
const DIRECTION_EAST  = 3;



/*
 * Définition de quelques codes de touches du clavier utilisées dans le jeu.
 */
const KEY_DOWN_ARROW  = 40;
const KEY_F           = 70;
const KEY_LEFT_ARROW  = 37;
const KEY_RIGHT_ARROW = 39;
const KEY_UP_ARROW    = 38;



/*
 * Définition des différents état du jeu.
 */
const GAME_STATE_END        = 1;    // Fin du jeu, victoire ou game over
const GAME_STATE_FIGHT      = 2;    // Combat dragon <-> joueur
const GAME_STATE_PLAY       = 3;    // Le joueur est sur la carte
const GAME_STATE_PLAY_START = 4;    // Le joueur est sur le point de départ sur la carte



/*
 * Les valeurs de ces constantes dépendent des valeurs des boutons radio du
 * formulaire de menu de démarrage :
 *
 * <input type="radio" name="difficulty" value="easy">
 * etc.
 */
const LEVEL_EASY   = 'easy';
const LEVEL_NORMAL = 'normal';
const LEVEL_HARD   = 'hard';



/*
 * Liste des armures et des épées disponibles dans le jeu.
 */
const ARMOR_COPPER  = 'Armure en cuivre';
const ARMOR_IRON    = 'Armure en fer';
const ARMOR_MAGICAL = 'Armure magique';

const SWORD_WOOD      = 'Epée en bois';
const SWORD_STEEL     = 'Epée en acier';
const SWORD_EXCALIBUR = 'Epée Excalibur';

/*
 * Tableau des données
 */
const TREASURE_TYPE_ARMOR = 1;
const TREASURE_TYPE_SWORD = 2;

var dataTreasures = new Array();

dataTreasures[LEVEL_EASY]   = { sword: SWORD_EXCALIBUR, armor: ARMOR_IRON    };
dataTreasures[LEVEL_NORMAL] = { sword: SWORD_STEEL,     armor: ARMOR_MAGICAL };
dataTreasures[LEVEL_HARD]   = { sword: SWORD_WOOD,      armor: ARMOR_COPPER  };



/*
 * Taille en pixels d'un carreau.
 */
const TILESET_PIXEL_SIZE = 16;



/*
 * Liste des carreaux disponibles dans le fichier image tileset.png.
 */
const TILE_DIRT         = 0;
const TILE_FLOOR        = 1;
const TILE_HERB         = 2;
const TILE_MOUNTAIN     = 3;
const TILE_MOUNTAIN_NE  = 4;
const TILE_MOUNTAIN_NW  = 5;
const TILE_MOUNTAIN_SE  = 6;
const TILE_MOUNTAIN_SW  = 7;
const TILE_MOUNTAIN_TOP = 8;
const TILE_ROCK1        = 9;
const TILE_ROCK2        = 10;
const TILE_STAIRS1      = 11;
const TILE_STAIRS2      = 12;
const TILE_STATUE1      = 13;
const TILE_STATUE2      = 14;
const TILE_TREE1        = 15;
const TILE_TREE2        = 16;
const TILE_WATER        = 17;
const TILE_WATER_E      = 18;
const TILE_WATER_N      = 19;
const TILE_WATER_NE     = 20;
const TILE_WATER_NW     = 21;
const TILE_WATER_S      = 22;
const TILE_WATER_SE     = 23;
const TILE_WATER_SW     = 24;
const TILE_WATER_W      = 25;

/*
 * Tableau de données d'informations sur les carreaux disponibles dans le fichier
 * image tileset.png.
 *
 * Les informations sont stockées sous la forme d'objets indiquant si on a le droit
 * de marcher sur le carreau (walkable) et les coordonnées (sx, sy) de l'image du
 * carreau à l'intérieur du fichier image tileset.png
 */
var dataTiles = new Array();

dataTiles[TILE_DIRT]         = { walkable: true,  sx: 32,  sy: 0  };
dataTiles[TILE_FLOOR]        = { walkable: true,  sx: 32,  sy: 48 };
dataTiles[TILE_HERB]         = { walkable: true,  sx: 80,  sy: 0  };
dataTiles[TILE_MOUNTAIN]     = { walkable: false, sx: 16,  sy: 32 };
dataTiles[TILE_MOUNTAIN_NE]  = { walkable: false, sx: 32,  sy: 16 };
dataTiles[TILE_MOUNTAIN_NW]  = { walkable: false, sx: 0,   sy: 16 };
dataTiles[TILE_MOUNTAIN_SE]  = { walkable: false, sx: 32,  sy: 32 };
dataTiles[TILE_MOUNTAIN_SW]  = { walkable: false, sx: 0,   sy: 32 };
dataTiles[TILE_MOUNTAIN_TOP] = { walkable: false, sx: 16,  sy: 16 };
dataTiles[TILE_ROCK1]        = { walkable: false, sx: 16,  sy: 0  };
dataTiles[TILE_ROCK2]        = { walkable: false, sx: 64,  sy: 0  };
dataTiles[TILE_STAIRS1]      = { walkable: true,  sx: 0,   sy: 0  };
dataTiles[TILE_STAIRS2]      = { walkable: true,  sx: 48,  sy: 0  };
dataTiles[TILE_STATUE1]      = { walkable: false, sx: 16,  sy: 48 };
dataTiles[TILE_STATUE2]      = { walkable: false, sx: 64,  sy: 48 };
dataTiles[TILE_TREE1]        = { walkable: false, sx: 0,   sy: 48 };
dataTiles[TILE_TREE2]        = { walkable: false, sx: 48,  sy: 48 };
dataTiles[TILE_WATER]        = { walkable: false, sx: 112, sy: 16 };
dataTiles[TILE_WATER_E]      = { walkable: false, sx: 128, sy: 16 };
dataTiles[TILE_WATER_N]      = { walkable: false, sx: 112, sy: 0  };
dataTiles[TILE_WATER_NE]     = { walkable: false, sx: 128, sy: 0  };
dataTiles[TILE_WATER_NW]     = { walkable: false, sx: 96,  sy: 0  };
dataTiles[TILE_WATER_S]      = { walkable: false, sx: 112, sy: 32 };
dataTiles[TILE_WATER_SE]     = { walkable: false, sx: 128, sy: 32 };
dataTiles[TILE_WATER_SW]     = { walkable: false, sx: 96,  sy: 32 };
dataTiles[TILE_WATER_W]      = { walkable: false, sx: 96,  sy: 16 };



/*
 * Liste des dragons existants dans le jeu.
 */
const DRAGON_TYPE_GREEN = 'Dragon Vert';
const DRAGON_TYPE_RED   = 'Dragon Rouge';
const DRAGON_TYPE_BLACK = 'Dragon Noir';

/*
 * Tableau des données d'information sur les dragons.
 *
 * Les différentes caractéristiques (attaque, défense, agilité, force) ainsi
 * que l'image affichée pour le dragon sont stockés dans ce tableau.
 */
var dataDragons = new Array();

dataDragons[DRAGON_TYPE_GREEN] = { attackLevel: 8,  defenseLevel: 10, agility: 5,  hp: 180, strength: 5  };
dataDragons[DRAGON_TYPE_RED]   = { attackLevel: 10, defenseLevel: 12, agility: 8,  hp: 210, strength: 10 };
dataDragons[DRAGON_TYPE_BLACK] = { attackLevel: 12, defenseLevel: 15, agility: 10, hp: 240, strength: 15 };



/*
 * Dimensions de la carte du jeu en nombre de carreaux.
 */
const MAP_HEIGHT = 30;
const MAP_WIDTH  = 40;

/*
 * Dimensions du monde du jeu en nombre de carreaux.
 */
const WORLD_HEIGHT = 30;
const WORLD_WIDTH  = 60;

/*
 * Carreaux utilisés pour représenter le monde du jeu.
 */
var dataWorld = [["16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","25","17","17","17","17","17","17","17","17","17","17","18","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","25","17","17","17","17","17","17","17","17","17"],["16","16","16","2","2","2","2","16","16","16","16","16","16","16","16","2","2","2","2","16","25","17","17","17","17","17","17","17","17","17","17","18","2","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","25","17","17","17","17","17","17","17","17","17"],["16","2","2","2","16","2","2","2","2","2","2","2","2","2","2","2","16","16","2","16","25","17","17","17","17","17","17","17","17","17","17","18","2","16","16","16","16","16","16","16","16","16","16","16","1","14","14","1","16","16","25","17","17","17","17","17","17","17","17","17"],["16","16","16","2","16","13","16","16","16","16","16","16","16","16","16","16","16","16","2","16","25","17","17","17","17","17","17","17","17","17","17","18","16","16","16","16","16","16","16","16","16","16","1","14","14","15","15","14","14","1","25","17","17","17","17","17","17","17","17","17"],["16","16","16","2","16","16","16","5","8","8","4","16","16","16","16","16","2","2","2","2","24","22","22","22","22","22","22","22","22","22","22","23","16","16","2","16","16","16","16","16","16","16","16","16","16","16","16","16","16","16","25","17","17","17","17","17","17","17","17","17"],["16","16","2","2","13","16","5","3","3","3","3","4","16","16","16","16","2","15","2","2","2","2","2","2","2","2","9","2","2","2","16","16","16","2","2","2","2","2","2","2","2","2","2","2","2","2","16","16","16","16","25","17","17","17","17","17","17","17","17","17"],["16","16","2","2","16","16","7","3","3","3","6","2","16","16","2","2","2","2","15","16","16","16","16","16","2","2","2","2","16","16","16","2","2","2","2","2","2","16","16","16","16","16","16","16","2","2","2","2","2","16","25","17","17","17","17","17","17","17","17","17"],["16","16","2","16","16","16","2","2","2","2","2","2","2","2","2","2","16","2","2","2","13","16","16","16","16","16","16","16","16","16","2","2","2","2","16","16","16","16","16","16","16","16","16","16","16","16","16",0,0,0,"25","17","17","17","17","17","17","17","17","17"],["16","12","2","16","16","2","2","16","16","16","16","16","16","16","2","16","16","16","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","16","16","16","16","16",0,"5","4",0,0,0,0,0,0,0,0,0,"25","17","17","17","17","17","17","17","17","17"],["16","16","16","16","16","2","2","2","2","16","16","16","16","16","2","10","10","10","21","19","19","19","19","20","16","16","16","2","16","2","16","16","16","16","16","16","16","16","5","3","3","4",0,0,0,0,0,0,0,0,"24","22","22","22","22","22","22","22","22","22"],["16","16","16","16","2","2","16","2","2","16","16","16","16","16","2","10","10","13","25","17","17","17","17","18","16","16","16","2","16","2","16","16","16","2","16","16",0,"5","3","3","3","3","4","15","15","15",0,0,"13",0,"13",0,"13","0","15","15","15",0,"5","8"],["16","16","16","16","2","2","16","16","2","16","16","16","2","2","2","2","2","2","25","17","17","17","17","18","2","16","16","2","2","2","2","16","2","2",0,0,"5","3","3","3","3","3","6","15","15","15",0,0,0,0,0,0,0,"15","15","15",0,"5","3","3"],["16","2","2","2","2","2","2","16","2","2","16","16","16","16","2","10","10","13","25","17","17","17","17","18","2","2","16","16","16","16","2","16","2","16","16",0,"7","3","3","6",0,0,0,"15","15","15","15",0,"13",0,"14",0,"13","15","15",0,"5","3","3","3"],["16","2","16","16","16","2","2","16","16","2","16","16","16","16","2","10","10","10","25","17","17","17","17","18","2","2","16","16","16","16","2","2","2","16","16",0,0,0,"0","14",0,"10",0,"14",0,"15","15","15",0,0,0,0,0,"15","15","5","3","3","3","3"],["16","2","16","16","16","2","2","2","2","2","2","2","2","2","2","2","2","2","25","17","17","17","17","18","2","2","2","16","2","16","16","16","2","16","16","16",0,0,0,0,0,0,0,0,0,0,"15","15","13","15","13",0,"13","15","5","3","3","3","3","3"],["16","2","2","16","16","2","2","2","16","16","16","16","16","2","2","16","16","2","25","17","17","17","17","18","16","16","2","2","2","2","2","2","2","16",0,0,"0","15","15",0,0,0,"15","15","15","15","15","15","15",0,0,0,0,0,"7","3","3","3","3","3"],["16","16","2","16","2","2","2","16","16","10","9","10","15","15",0,0,"16","16","25","17","17","17","17","18","16","16","16","16","2","2","16","16","16","16","16",0,"15","15","15","15","15","15","15","15",0,0,"15","15","15","15",0,0,"9","9","16","16","16",0,"7","3"],["16","16","16","16","16","2","2","16","16","9",0,"9","15","15","15",0,0,0,"25","17","17","17","17","18","16","16","16","16","16","2","2","2","2","2","2",0,0,"15","15","15","15","15","15","15",0,0,"15","15","15","15","15","11",0,0,0,0,0,0,0,"7"],["16","16","16","16","2","2","2","16","16","16",0,0,"15","15",0,0,"16",0,"25","17","17","17","17","18","16","2","2","16","16","16","2","2","16","2","2","15","15","15","15","15","15","15","15",0,0,0,0,"15","15","15","15","15","15","15","15",0,0,0,"21","19"],["16","16","16","2","2","2","16","16","16",0,0,"15","15","15",0,0,"16",0,"25","17","17","17","17","18","2","2","2","2","2","2","2","2","16","2","2","16","15","15","15","15","15","15","14",0,"14","15","15","15",0,"15","15","15","15","15","15","15",0,0,"25","17"],["16","16","2","2","2","2","16","16","13",0,0,0,0,0,0,"16","16","16","25","17","17","17","17","18","16","16","2","2","2","2","2","2","16","2","2","16","16","15","15","15","15","15","15",0,"15","15",0,0,0,0,"15","15","15","15","15","15","15",0,"25","17"],["16","16","2","2","16","16","16","16","16",0,0,0,"9","9","16","16","16","16","24","22","22","22","22","23","16","16","2","2","2","10","16","16","16","2","2","16","5","4","15","15","15",0,0,0,0,0,0,0,0,0,0,0,0,0,0,"15","15","15","24","22"],["16","16","2","2","2","2","16","16","9","9",0,"9","9","16","16","16","16","16","16","16","16","2","12","16","16","10","13","13","10","10","16","16","16","2","2","5","3","3","4","15","15",0,0,"15",0,0,"5","8","8","8","8","8","8","8","4",0,"15","15","15","15"],["16","16","2","2","2","16","16","16","9","9",0,0,"9","16","16","2","2","16","16","16","16","2","16","16","2","2","16","16","16","16","16","16","2","2","2","7","3","3","6","15",0,0,0,0,0,"5","3","3","3","3","3","3","3","3","3","4",0,"15","15","15"],["16","16","16","2","2","16","16","16","16","9","11","0","16","16","16","2","2","2","16","16","16","2","2","2","2","2","2","2","2","2","2","2","2","2","2","0","0","0",0,0,0,0,0,0,"5","3","3","3","3","3","3","3","3","3","3","3","4",0,0,0],["16","16","16","2","2","2","16","16","16","16","9","16","16","16","2","2","13","2","2","16","16","16","16","16","16","2","2","10","10","10","16","16","2","2","5","4","0","0","0","5","8","8","8","8","3","3","3","3","3","3","3","3","3","3","3","3","3","4",0,0],["16","16","16","2","2","2","2","2","16","16","16","16","16","2","2","2","2","2","2","16","16","16","16","16","16","2","2","2","2","2","16","2","2","5","3","3","4","0","5","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","4",0],["19","19","19","19","19","19","19","19","19","19","19","19","19","19","19","20","2","2","2","2","2","16","16","16","16","16","16","16","16","2","2","2","5","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","4"],["17","17","17","17","17","17","17","17","17","17","17","17","17","17","17","18","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","5","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3"],["17","17","17","17","17","17","17","17","17","17","17","17","17","17","17","18","5","8","8","8","8","8","8","8","8","8","8","8","8","8","8","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3"]];

/*
 * Evenements pouvant se produire dans le monde du jeu.
 */
var dataWorldEvents =
[
    { x: 10, y: 24, done: false, what: 'dragon-1'   },
    { x: 1,  y: 8,  done: false, what: 'treasure-2' },
    { x: 22, y: 22, done: false, what: 'treasure-1' },
    { x: 51, y: 17, done: false, what: 'dragon-2'   }
];